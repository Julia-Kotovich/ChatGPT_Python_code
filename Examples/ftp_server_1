from ftplib import FTP, error_perm
import os

# Set the IP address and port number for the server to listen on
ip_address = "127.0.0.1"
port = 2121

# Define the FTP handler class
class FTPHandler(FTP):
    def __init__(self, conn, dir_path):
        # Call the superclass constructor
        super().__init__(conn)
        # Set the current directory to the specified directory path
        self.cwd(dir_path)
    
    # Override the FTP command handlers
    def handle(self):
        # Print a message indicating that a new connection has been established
        print("New connection established.")
        # Call the superclass handle() method to handle the client's commands
        super().handle()

# Define the main function
def main():
    # Create an FTP server instance
    ftp_server = FTPHandler
    # Set the directory path to be used for serving files
    dir_path = os.getcwd()
    # Start the FTP server
    ftp_server.bind((ip_address, port))
    ftp_server.listen(5)
    print(f"FTP server listening on {ip_address}:{port}...")
    while True:
        # Wait for a new client connection
        conn, addr = ftp_server.accept()
        # Create a new FTP handler instance for the client connection
        handler = ftp_server(conn, dir_path)
        # Handle the client's commands
        handler.handle()
        # Close the client connection
        handler.close()

# Call the main function when the script is run
if __name__ == "__main__":
    main()
